 <div class="main-content page-m">
  <div class="section-content section-content-p30">
    <div class="container-fluid">

      <h3 class="title-1 mb-3">Your Orders</h3>

      <div *ngIf="orderHistoryList.length > 0; else noOrders">
        <table class="table table-striped table-bordered shadow-sm">
          <thead class="table-primary">
            <tr>
              <th width="25%">Order Tracking Number</th>
              <th width="15%">Total Price</th>
              <th width="15%">Total Quantity</th>
              <th width="20%">Date</th>
              <th width="10%">Action</th>
            </tr>
          </thead>

        <tbody>
          <ng-container *ngFor="let order of orderHistoryList">
            <tr>
              <td>{{ order.orderTrackingNumber }}</td>
              <td>{{ order.totalPrice | currency: 'USD' }}</td>
              <td>{{ order.totalQuantity }}</td>
              <td>{{ order.dateCreated | date: 'medium' }}</td>
              <td>
                <button class="btn btn-sm btn-outline-info"
                        (click)="toggleOrderDetails(toNum(order.id))">
                  {{ expandedOrderId === toNum(order.id) ? 'Hide' : 'View Details' }}
                </button>
              </td>
            </tr>

            <tr *ngIf="expandedOrderId === toNum(order.id)">
              <td colspan="5">
                <div *ngIf="orderItemsMap.has(toNum(order.id)); else loading">
                  <div class="row">
                    <div *ngFor="let item of orderItemsMap.get(toNum(order.id))"
                         class="col-md-3 mb-3">
                      <div class="card h-100 text-center shadow-sm">
                        <img [src]="item.imageUrl"
                             alt="Product image"
                             class="card-img-top"
                             style="max-height: 120px; object-fit: contain;">
                        <div class="card-body">
                          <p class="card-text mb-1"><strong>Product ID:</strong> {{ item.productId }}</p>
                          <p class="card-text mb-1"><strong>Price:</strong> {{ item.unitPrice | currency: 'USD' }}</p>
                          <p class="card-text mb-0"><strong>Qty:</strong> {{ item.quantity }}</p>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <ng-template #loading>
                  <div class="text-center text-muted mt-3">Loading order items...</div>
                </ng-template>
              </td>
            </tr>
          </ng-container>
        </tbody>
        </table>
      </div>

      <ng-template #noOrders>
        <div class="alert alert-warning mt-3">You haven't placed any orders yet.</div>
      </ng-template>

    </div>
  </div>
</div>
